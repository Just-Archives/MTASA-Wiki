<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Scripting the GUI - Tutorial 1 - Multi Theft Auto: Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Scripting_the_GUI_-_Tutorial_1","wgTitle":"Scripting the GUI - Tutorial 1","wgCurRevisionId":60911,"wgRevisionId":60911,"wgArticleId":5023,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["GUI Tutorials"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Scripting_the_GUI_-_Tutorial_1","wgRelevantArticleId":5023,"wgRequestId":"f47f26b11da4f581bda014cb","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":false,"dialogs":false,"preview":false,"publish":false}});mw.loader.implement("user.options",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="http://wiki.localhost/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook"/>
<!--[if IE 6]><link rel="stylesheet" href="/skins/MonoBook/IE60Fixes.css?303" media="screen"/><![endif]--><!--[if IE 7]><link rel="stylesheet" href="/skins/MonoBook/IE70Fixes.css?303" media="screen"/><![endif]-->
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="http://wiki.localhost/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook"/>
<script async="" src="http://wiki.localhost/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook"></script>
<meta name="generator" content="MediaWiki 1.27.5"/>
<link rel="shortcut icon" href="http://wiki.localhost/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.localhost/opensearch_desc.php" title="Multi Theft Auto: Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.multitheftauto.com/api.php?action=rsd"/>
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html"/>
<link rel="alternate" type="application/atom+xml" title="Multi Theft Auto: Wiki Atom feed" href="http://wiki.localhost/index.php?title=Special:RecentChanges&amp;feed=atom"/>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Scripting_the_GUI_-_Tutorial_1 rootpage-Scripting_the_GUI_-_Tutorial_1 skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Scripting the GUI - Tutorial 1</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Multi Theft Auto: Wiki</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p><b>Scripting the Gui - Tutorial 1 (Gridlists)</b>
</p><p>In this tutorial we will explore the use of gridlists in creating a vehicle selection screen, with optional clientside vehicle xml data reading.
</p><p><b>Note that this tutorial assumes you are familiar with all the content covered in the <a href="Introduction_to_Scripting_GUI.html" title="Introduction to Scripting GUI" class="mw-redirect">Previous tutorial</a>.</b>
</p><p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Setting_up_the_Vehicle_Selection"><span class="tocnumber">1</span> <span class="toctext">Setting up the Vehicle Selection</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Creating_the_GUI"><span class="tocnumber">1.1</span> <span class="toctext">Creating the GUI</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Showing_the_GUI"><span class="tocnumber">1.2</span> <span class="toctext">Showing the GUI</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Populating_the_Gridlist_from_a_table"><span class="tocnumber">1.3</span> <span class="toctext">Populating the Gridlist from a table</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Managing_the_click"><span class="tocnumber">1.4</span> <span class="toctext">Managing the click</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Creating_the_Vehicle"><span class="tocnumber">1.5</span> <span class="toctext">Creating the Vehicle</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Expanding_the_code"><span class="tocnumber">2</span> <span class="toctext">Expanding the code</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#Importing_Data"><span class="tocnumber">2.1</span> <span class="toctext">Importing Data</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Collapsing.2FExpanding_the_Gridlist"><span class="tocnumber">2.2</span> <span class="toctext">Collapsing/Expanding the Gridlist</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Loading_the_data"><span class="tocnumber">2.3</span> <span class="toctext">Loading the data</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Managing_the_double_click"><span class="tocnumber">2.4</span> <span class="toctext">Managing the double click</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Setting_up_the_Vehicle_Selection">Setting up the Vehicle Selection</span></h2>
<h3><span class="mw-headline" id="Creating_the_GUI">Creating the GUI</span></h3>
<p>To begin, open up a clientside lua file (if you have been following the <a href="Scripting_Introduction.html" title="Scripting Introduction">Scripting Introduction</a>, this is gui.lua) to work with.
</p><p>In this file, we will start writing our function for creating the GUI.
As covered in the <a href="Introduction_to_Scripting_GUI.html" title="Introduction to Scripting GUI" class="mw-redirect">Previous tutorial</a>, there are 2 value type options available when creating gui: <b>relative</b> and <b>absolute</b>.
</p><p>For the purposes of this tutorial, we will be using <b>absolute</b> values.
</p><p><br />
This will create a simple GUI with a window, gridlist and button:
</p>
<pre class="prettyprint lang-lua">
function createVehicleSelection()
	-- get the screen width and height
	local sWidth, sHeight = guiGetScreenSize()
	
	-- use some simple maths to position the window in the centre of the screen
	local Width,Height = 376,259
	local X = (sWidth/2) - (Width/2)
	local Y = (sHeight/2) - (Height/2)
	windowVehicleSelection = guiCreateWindow(X,Y,Width,Height,"Vehicle Selection Window",false)
	
	gridlistVehicleSelection = guiCreateGridList(10,26,357,192,false,windowVehicleSelection)
	-- add a "Vehicle" and a "Type" collumn to the gridlist
	guiGridListAddColumn(gridlistVehicleSelection,"Vehicle",0.2)
	guiGridListAddColumn(gridlistVehicleSelection,"Type",0.2)
	
	-- set the default width of the columns to roughly half the size of the gridlist (each)
	guiGridListSetColumnWidth(gridlistVehicleSelection,1,0.4,true)
	guiGridListSetColumnWidth(gridlistVehicleSelection,2,0.5,true)
	
	buttonCreate = guiCreateButton(121,227,120,20,"Create",false,windowVehicleSelection)
	
	-- add the event handler for when the button is clicked
	addEventHandler("onClientGUIClick",buttonCreate,createVehicleHandler,false)
	
	-- hide the GUI
	guiSetVisible(windowVehicleSelection,false)
	
	-- this will add all the vehicle options onto the gridlist, it is explained later in this tutorial
	populateGridlist()
end
</pre>
<p>We now also need to call this function somewhere, otherwise the GUI will never be created.
As in previous tutorials, to do this we can use <a href="OnClientResourceStart.html" title="OnClientResourceStart">onClientResourceStart</a>.
</p>
<pre class="prettyprint lang-lua">
-- when the resource is started, create the GUI and hide it
addEventHandler("onClientResourceStart",getResourceRootElement(getThisResource()),
	function()
		createVehicleSelection()
	end
)
</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Showing_the_GUI">Showing the GUI</span></h3>
<p>Unlike in previous tutorials, we want players to be able to open this window whenever they chose, not when the resource starts. 
So, we can add a <a href="AddCommandHandler.html" title="AddCommandHandler">Command</a> to do this.
</p>
<pre class="prettyprint lang-lua">
-- create the function that will show the window
function showVehicleSelection()
	-- if the window isnt visible, show it
	if not guiGetVisible(windowVehicleSelection) then
		guiSetVisible(windowVehicleSelection,true)
		
		showCursor(true,true)
	end
end

-- add the command /vehicleselection and set it to call the showVehicleSelection function
addCommandHandler("vehicleselection",showVehicleSelection)
</pre>
<h3><span class="mw-headline" id="Populating_the_Gridlist_from_a_table">Populating the Gridlist from a table</span></h3>
<p>Now that we have our basic GUI created, we need to fill the gridlist with all of our vehicles.
</p><p>To begin with, we will do this using a simple clientside table. 
Later in the tutorial, we will explore expanding this method to use .xml files for storing information.
To begin, we must create a small table containing a selection of vehicles that we can spawn.
</p><p>The table contains vehicles in the format ["description"] = vehicle_id&#160;:
</p>
<pre class="prettyprint lang-lua">
-- create the table and fill it with a selection of vehicle ids and names
local vehicleSelectionTable = {
	["Sparrow"] = 469,
	["Stuntplane"] = 513,
	["BF-400"] = 581,
	["Freeway"] = 463,
	["Speeder"] = 452,
	["Jester"] = 559,
	["Sabre"] = 475,
	["Police Ranger"] = 599,
	["Utility Van"] = 552,
	["Tug"] = 583
}
</pre>
<p>Place this code at the very top of your file (it does not need to be inside a function).
</p><p>Next, we can write our "populateGridlist" function which will fill the Gridlist with all the vehicles in the table.
To do this we simply need to loop through all the values in the table, adding each one to the gridlist as we go.
We will also set hidden data using <a href="GuiGridListSetItemData.html" title="GuiGridListSetItemData">guiGridListSetItemData</a> to store the vehicle id:
</p>
<pre class="prettyprint lang-lua">
function populateGridlist()
	-- loop through the table
	for name,vehicle in pairs(vehicleSelectionTable) do
		-- add a new row to the gridlist
		local row = guiGridListAddRow(gridlistVehicleSelection)

		-- set the text in the first column to the vehicle name
		guiGridListSetItemText(gridlistVehicleSelection,row,1,name,false,false)
		-- set the text in the second column to the vehicle type
		guiGridListSetItemText(gridlistVehicleSelection,row,2,getVehicleType(vehicle),false,false)
		
		-- set the data for gridlist slot as the vehicle id
		guiGridListSetItemData(gridlistVehicleSelection,row,1,tostring(vehicle))
	end
end
</pre> 
<h3><span class="mw-headline" id="Managing_the_click">Managing the click</span></h3>
<p>Now that we have our GUI completed, we need to be able to catch any clicks made on the "create" button.
We have attached the <a href="OnClientGUIClick.html" title="OnClientGUIClick">onClientGUIClick</a> event to buttonCreate already, so now we need to write the function that it calls.
In this function we do some basic error checking, such as making sure a vehicle has been selected in the list. 
We can then use some maths to find a position infront of the player and send the server this information to spawn the vehicle (using <a href="TriggerServerEvent.html" title="TriggerServerEvent">triggerServerEvent</a>) 
</p>
<pre class="prettyprint lang-lua">
function createVehicleHandler(button,state)
	if button == "left" and state == "up" then
		-- get the selected item in the gridlist
		local row,col = guiGridListGetSelectedItem(gridlistVehicleSelection)
		
		-- if something is selected
		if row and col and row ~= -1 and col ~= -1 then
			-- get the vehicle id data from the gridlist that is selected
			local selected = guiGridListGetItemData(gridlistVehicleSelection,row,col)
			
			-- make sure the vehicle id is a number not a string
			selected = tonumber(selected)
						
			-- get the players position and rotation
			local rotz = getPedRotation(getLocalPlayer())
			local x,y,z = getElementPosition(getLocalPlayer())
			-- find the position directly infront of the player
			x = x + ( math.cos ( math.rad ( rotz+90 ) ) * 3)
			y = y + ( math.sin ( math.rad ( rotz+90 ) ) * 3)
			
			if selected and x and y and z then
				-- trigger the server
				triggerServerEvent("createVehicleFromGUI",getRootElement(),selected,x,y,z)
				
				-- hide the gui and the cursor
				guiSetVisible(windowVehicleSelection,false)
				showCursor(false,false)
			else
				outputChatBox("Invalid arguments.")
			end
		else
			-- otherwise, output a message to the player
			outputChatBox("Please select a vehicle.")
		end
	end
end
</pre>
<h3><span class="mw-headline" id="Creating_the_Vehicle">Creating the Vehicle</span></h3>
<p>At this point we now have all the code needed on the client side, so open up a serverside .lua file to work with. 
</p><p>On the server side, we will first of all need to define the custom event that we triggered before from the client. This can be done using <a href="AddEvent.html" title="AddEvent">addEvent</a> and <a href="AddEventHandler.html" title="AddEventHandler">addEventHandler</a>.
Finally we will need a small function for creating the vehicle:
</p>
<pre class="prettyprint lang-lua">
function createMyVehicle(vehicleid,x,y,z)
	-- check all the arguments exist
	if vehicleid and x and y and z then
		createVehicle(vehicleid,x,y,z)
	end
end

addEvent("createVehicleFromGUI",true)
addEventHandler("createVehicleFromGUI",root,createMyVehicle)
</pre>
<p>Note the use of the "root" variable. This is an MTA variable containing the root element; every resource has one.
</p><p>This completes the first section of the tutorial. You should now have a basic, working vehicle spawn script.
</p><p>In the second section, we will cover collapsible gridlist data and clientside xml file reading.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Expanding_the_code">Expanding the code</span></h2>
<p>This section will detail several ways to improve upon the code you now have.
</p>
<h3><span class="mw-headline" id="Importing_Data">Importing Data</span></h3>
<p>One big improvement over the previously mentioned method is to use external files to store the vehicle information, allowing us to much more quickly and easily manage large amounts of data.
For this tutorial, we will use a clientside xml file to hold the information.
</p><p>First of all you will need to create your xml file, so navigate to your resources directory and create a new file named vehicles.xml:
</p><p><i>For the purpose of this example, we will include only a small fraction of the total vehicles, however the file can easily be expanded to include them all.</i>
</p><p>If you are unsure of xml data structures, you can browse the <a href="Server_Scripting_Functions.html#XML_functions" title="Server Scripting Functions"> MTA xml functions</a> for help.
</p>
<pre class="prettyprint lang-lua">
&lt;root&gt;
	&lt;group type="Bikes"&gt;
		&lt;vehicle id="581" name="BF-400"/&gt;
		&lt;vehicle id="463" name="Freeway"/&gt;
		&lt;vehicle id="481" name="BMX"/&gt;
	&lt;/group&gt;
	&lt;group type="Boats"&gt;
		&lt;vehicle id="472" name="Coastguard"/&gt;
		&lt;vehicle id="452" name="Speeder"/&gt;
	&lt;/group&gt;
	&lt;group type="Helicopters"&gt;
		&lt;vehicle id="487" name="Maverick"/&gt;
		&lt;vehicle id="469" name="Sparrow"/&gt;	
	&lt;/group&gt;
	&lt;group type="Planes"&gt;
		&lt;vehicle id="593" name="Dodo"/&gt;
		&lt;vehicle id="513" name="Stuntplane"/&gt;	
	&lt;/group&gt;
	&lt;group type="Sports Cars"&gt;
		&lt;vehicle id="565" name="Flash"/&gt;
		&lt;vehicle id="559" name="Jester"/&gt;
		&lt;vehicle id="477" name="ZR-350"/&gt;	
	&lt;/group&gt;
	&lt;group type="2-Door"&gt;
		&lt;vehicle id="474" name="Hermes"/&gt;
		&lt;vehicle id="475" name="Sabre"/&gt;
	&lt;/group&gt;
	&lt;group type="Emergency"&gt;
		&lt;vehicle id="416" name="Ambulance"/&gt;
		&lt;vehicle id="599" name="Police ranger"/&gt;
	&lt;/group&gt;
	&lt;group type="Industrial"&gt;
		&lt;vehicle id="573" name="Dune"/&gt;
		&lt;vehicle id="552" name="Utility van"/&gt;	
	&lt;/group&gt;
	&lt;group type="Misc"&gt;
		&lt;vehicle id="457" name="Caddy"/&gt;
		&lt;vehicle id="583" name="Tug"/&gt;
	&lt;/group&gt;
&lt;/root&gt;
</pre>
<p>Once you have created your file, do not forget to add it to the meta.xml of your resource with the appropriate client tag.
</p><p>Note the group "type" tag. This is an arbitrary description of the vehicles contained within the group and can be renamed or added as any text.
Similarly, the vehicle "name" tag is also just a textual description of the vehicle and does not need to be the exact vehicle name.
</p><p>Now that we have the data, we can import it into the game and display it in the GUI.
<b>If you are following on from the first section of this tutorial, this new code will replace what is inside your existing 'populateGridlist' function.</b>
First, we need to load the file:
</p>
<pre class="prettyprint lang-lua">
function populateGridlist()
	-- load the file and save the root node value it returns
	local rootnode = xmlLoadFile("vehicles.xml")
	
	-- check that the file exists and has been correctly loaded
	if rootnode then		
		-- unload the xml file
		xmlUnloadFile(rootnode)
	end
end
</pre>
<p>Always make sure you unload any files once you are finished using them.
</p><p><br />
We can now start collecting the data from the file and entering it into our gridlist.
We can do this by looping through the xml data (in a similar manner to looping through the vehicle table earlier in this tutorial) and adding each entry into the list.
</p>
<pre class="prettyprint lang-lua">
function populateGridlist()
	local rootnode = xmlLoadFile("vehicles.xml")
	
	if rootnode then		
		-- first, we find every "group" node (they are direct children of the root)
		for _,group in ipairs(xmlNodeGetChildren(rootnode)) do
			-- add a new row to the gridlist
			local row = guiGridListAddRow(gridlistVehicleSelection)

			-- get the group name
			local name = xmlNodeGetAttribute(group,"type")
			
			-- set the text in the first column to the group type and indicate it is a section ('true')
			-- (sections on gridlists show up in bold and cannot be clicked)
			guiGridListSetItemText(gridlistVehicleSelection,row,1,name,true,false)			
		
			-- then, for every group that we find, loop all of its children (the vehicle nodes)
			-- and add them into the gridlist
			for _,vehicle in ipairs(xmlNodeGetChildren(group)) do
				-- add a new row to the gridlist
				row = guiGridListAddRow(gridlistVehicleSelection)

				-- get the vehicle name and id
				name = xmlNodeGetAttribute(vehicle,"name")
				local id = xmlNodeGetAttribute(vehicle,"id")
				
				-- set the text in the first column to the vehicle name
				guiGridListSetItemText(gridlistVehicleSelection,row,1,name,false,false)
				-- set the text in the second column to the vehicle type
				guiGridListSetItemText(gridlistVehicleSelection,row,2,getVehicleType(tonumber(id)),false,false)		
				
				-- finally, set the vehicle id as data so we can access it later
				guiGridListSetItemData(gridlistVehicleSelection,row,1,tostring(id))
			end
		end	
	
		-- unload the xml file now that we are finished
		xmlUnloadFile(rootnode)
	end
end
</pre>
<p>Note the use of for loops in the code with <a href="XmlNodeGetChildren.html" title="XmlNodeGetChildren">xmlNodeGetChildren</a>. This saves us a lot of time and effort as we do not have to manually code each group and vehicle into the list.
</p><p>You should now have a fully working vehicle selection menu, reading all of its data from a clientside xml file.
Next, we will examine how to generate the appearance of collapsing and expanding sections in a gridlist.
</p>
<h3><span class="mw-headline" id="Collapsing.2FExpanding_the_Gridlist">Collapsing/Expanding the Gridlist</span></h3>
<p>Allowing sections of the gridlist to be collapsed or expanded gives much more control over the visible content to the user.
This frees up space on the screen and makes the whole menu much more comfortable to use.
</p>
<h3><span class="mw-headline" id="Loading_the_data">Loading the data</span></h3>
<p>To be able to achieve this effect (as it is not a natural feature of gridlists) we will need to load the vehicle information into a table (from the xml file), rather than directly including it all in the gridlist.
<b>If you are following on from a previous section of this tutorial, this new code will replace what is inside your existing 'populateGridlist' function.</b>
</p><p>This works in much the same way the previous xml loading example does, only this time instead of saving the data into the gridlist, we save it into a table entry instead.
We also set the custom data "header" on the gridlist slots to denote which gridlist entries are our "group" entries and which are vehicles.
</p>
<pre class="prettyprint lang-lua">
function populateGridlist()
	local rootnode = xmlLoadFile("vehicles.xml")
	
	-- create a blank global table to store our imported data
	vehicleTable = {}
	
	if rootnode then		
		for _,group in ipairs(xmlNodeGetChildren(rootnode)) do
			-- create an entry in the gridlist for every vehicle "group"
			local row = guiGridListAddRow(gridlistVehicleSelection)

			local name = xmlNodeGetAttribute(group,"type")
			
			guiGridListSetItemText(gridlistVehicleSelection,row,1,name,false,false)	

			-- add an entry containing the group name into the table
			vehicleTable[name] = {}
			
			-- we will use the custom data "header" to indicate that this entry can be expanded/collapsed
			guiGridListSetItemData(gridlistVehicleSelection,row,1,"header")	
		
			-- then, for every group that we find, loop all of its children (the vehicle nodes) and store them in a table
			for _,vehicle in ipairs(xmlNodeGetChildren(group)) do
				local vname = xmlNodeGetAttribute(vehicle,"name")
				local id = xmlNodeGetAttribute(vehicle,"id")			
			
				-- insert both the vehicle id and the vehicle description into the table
				table.insert(vehicleTable[name],{id,vname})
			end
		end	
	
		-- set element data on the gridlist so we know which group is currently showing
		setElementData(gridlistVehicleSelection,"expanded","none")
	
		-- unload the xml file now that we are finished
		xmlUnloadFile(rootnode)
	end
end
</pre>
<p>Now that we have all the data stored, we can quickly manipulate it when neccessary.
</p>
<h3><span class="mw-headline" id="Managing_the_double_click">Managing the double click</span></h3>
<p>To enable the player to simply double click on a group name to expand/collapse it we need to use the <a href="OnClientGUIDoubleClick.html" title="OnClientGUIDoubleClick">onClientGUIDoubleClick</a> event.
If we attach it to the gridlist, we can then catch any double clicks on the group names in it:
</p>
<pre class="prettyprint lang-lua">
-- attach the onClientGUIDoubleClick event to the gridlist and set it to call processDoubleClick
addEventHandler("onClientGUIDoubleClick",gridlistVehicleSelection,processDoubleClick,false)
</pre>
<p>Add this line of code in your createVehicleSelection, after the gridlist has been created.
</p><p><br />
As the gridlist items are not separate GUI elements, we must capture all clicks from anywhere on the gridlist then process them to filter out the ones we do not want.
This can be done by checking if an item is selected, then checking if the item is one of our "group" values (using our previously mentioned "header" data):
</p>
<pre class="prettyprint lang-lua">
function processDoubleClick(button,state)
	if button == "left" and state == "up" then
		local row,col = guiGridListGetSelectedItem(gridlistVehicleSelection)
		
		-- if something in the gridlist has been selected
		if row and col and row ~= -1 and col ~= -1 then		
			-- if it is a header
			if guiGridListGetItemData(gridlistVehicleSelection,row,col) == "header" then
				local selected = guiGridListGetItemText(gridlistVehicleSelection,row,col)
				
				-- call the function to collapse or expand the menu and pass which section it is as an argument
				changeGridlistState(selected)
			end
		end
	end
end
</pre>
<p>Once we have narrowed down the double clicks to only those done on our group headers, we can expand/collapse them appropriately.
This can be done by simply setting new text values in the gridlist according to the newly expanded/collapsed group, which creates the convincing illusion of collapsable menus.
</p><p><br />
Note that much of the following code is reused from previous areas of this tutorial. While it is generally bad practice to clone sections of code in this way, for the purposes of this example it is far easier to understand.
</p>
<pre class="prettyprint lang-lua">
function changeGridlistState(group)
	if group then
		-- if the group is already expanded, we want to collapse it
		if getElementData(gridlistVehicleSelection,"expanded") == group then
			-- first, we clear all previous data from the gridlist
			guiGridListClear(gridlistVehicleSelection)
			
			-- now, loop all the group entries in the vehicle table that we created earlier
			for group,_ in pairs(vehicleTable) do
				-- add each group to the list and mark them with "header"			
				local row = guiGridListAddRow(gridlistVehicleSelection)
				
				guiGridListSetItemText(gridlistVehicleSelection,row,1,group,false,false)	
				guiGridListSetItemData(gridlistVehicleSelection,row,1,"header")	
			end
			
			-- update the data to indicate that no groups are currently expanded
			setElementData(gridlistVehicleSelection,"expanded","none")
			
		-- otherwise, we want to expand it
		else
			guiGridListClear(gridlistVehicleSelection)
			
			local row = guiGridListAddRow(gridlistVehicleSelection)
			
			guiGridListSetItemText(gridlistVehicleSelection,row,1,group,false,false)	
			guiGridListSetItemData(gridlistVehicleSelection,row,1,"header")				
			
			-- loop every vehicle in the specified groups table
			for _,vehicle in ipairs(vehicleTable[group]) do
				-- add them to the gridlist and set the vehicle id as data
				row = guiGridListAddRow(gridlistVehicleSelection)
			
				-- format a "-" into the string to make it visually easier to distinguish between groups and vehicles
				guiGridListSetItemText(gridlistVehicleSelection,row,1,"- "..vehicle[2],false,false)	
				guiGridListSetItemText(gridlistVehicleSelection,row,2,getVehicleType(tonumber(vehicle[1])),false,false)	
											
				guiGridListSetItemData(gridlistVehicleSelection,row,1,tostring(vehicle[1]))
			end	

			-- update the data to indicate which group is currently expanded
			setElementData(gridlistVehicleSelection,"expanded",group)			
		end
	end
end
</pre>
<p>This completes the second section of the tutorial.
</p><p>For further GUI tutorials, see <a href="Scripting_the_GUI_-_Tutorial_2.html" title="Scripting the GUI - Tutorial 2">Tutorial 2 (Gates and Keypads)</a>
</p>
<!-- 
NewPP limit report
Cached time: 20190625164819
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.007 seconds
Real time usage: 0.008 seconds
Preprocessor visited node count: 151/1000000
Preprocessor generated node count: 328/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key mta_wiki-wiki_dev_:pcache:idhash:5023-0!*!0!!en!*!* and timestamp 20190625164819 and revision id 60911
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.multitheftauto.com/index.php?title=Scripting_the_GUI_-_Tutorial_1&amp;oldid=60911">https://wiki.multitheftauto.com/index.php?title=Scripting_the_GUI_-_Tutorial_1&amp;oldid=60911</a>"</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="Category_GUI_Tutorials.html" title="Category:GUI Tutorials">GUI Tutorials</a></li></ul></div></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="Scripting_the_GUI_-_Tutorial_1.html" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="http://wiki.localhost/index.php?title=Talk:Scripting_the_GUI_-_Tutorial_1&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="http://wiki.localhost/index.php?title=Scripting_the_GUI_-_Tutorial_1&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="http://wiki.localhost/index.php?title=Scripting_the_GUI_-_Tutorial_1&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="http://wiki.localhost/index.php?title=Special:CreateAccount&amp;returnto=Scripting+the+GUI+-+Tutorial+1" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="http://wiki.localhost/index.php?title=Special:UserLogin&amp;returnto=Scripting+the+GUI+-+Tutorial+1" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="Main_Page.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Home"><a href="Main_Page.html">Home</a></li>
											<li id="n-How-you-can-help"><a href="How_you_can_help.html">How you can help</a></li>
											<li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="Special_Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-reference" role="navigation">
		<h3>reference</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Client-Functions"><a href="Client_Scripting_Functions.html">Client Functions</a></li>
											<li id="n-Client-Events"><a href="Client_Scripting_Events.html">Client Events</a></li>
											<li id="n-Server-Functions"><a href="Server_Scripting_Functions.html">Server Functions</a></li>
											<li id="n-Server-Events"><a href="Server_Scripting_Events.html">Server Events</a></li>
											<li id="n-Shared-Functions"><a href="Shared_Scripting_Functions.html">Shared Functions</a></li>
											<li id="n-Useful-Functions"><a href="Useful_Functions.html">Useful Functions</a></li>
											<li id="n-MTA-Classes"><a href="MTA_Classes.html">MTA Classes</a></li>
											<li id="n-MTA-Elements"><a href="Element.html">MTA Elements</a></li>
											<li id="n-Element-Tree"><a href="Element_tree.html">Element Tree</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="http://wiki.localhost/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Multi Theft Auto: Wiki [f]" accesskey="f" id="searchInput"/>
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton"/>&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton"/>
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/Scripting_the_GUI_-_Tutorial_1.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/Scripting_the_GUI_-_Tutorial_1.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="http://wiki.localhost/index.php?title=Scripting_the_GUI_-_Tutorial_1&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="http://wiki.localhost/index.php?title=Scripting_the_GUI_-_Tutorial_1&amp;oldid=60911" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="http://wiki.localhost/index.php?title=Scripting_the_GUI_-_Tutorial_1&amp;action=info" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
				<div id="p-lang" class="portlet" role="navigation">
				<h3>In other languages</h3>

				<div class="pBody">
					<ul>
													<li class="interlanguage-link interwiki-hu"><a href="http://wiki.multitheftauto.com/index.php?title=HU/Scripting_the_GUI_-_Tutorial_1" title="Scripting the GUI - Tutorial 1 – magyar" lang="hu" hreflang="hu">Magyar</a></li>
											</ul>

									</div>
			</div>
				</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="http://www.gnu.org/copyleft/fdl.html"><img src="http://wiki.localhost/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.2" width="88" height="31"/></a>
							</div>
					<div id="f-poweredbyico">
									<a href="http://www.mediawiki.org/"><img src="http://wiki.localhost/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>
							</div>
					<ul id="f-list">
									<li id="lastmod"> This page was last modified on 25 November 2018, at 13:34.</li>
									<li id="copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.2</a> unless otherwise noted.</li>
									<li id="privacy"><a href="Multi_Theft_Auto__Wiki_Privacy_policy.html" title="Multi Theft Auto: Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="Multi_Theft_Auto__Wiki_About.html" title="Multi Theft Auto: Wiki:About">About Multi Theft Auto: Wiki</a></li>
									<li id="disclaimer"><a href="Multi_Theft_Auto__Wiki_General_disclaimer.html" title="Multi Theft Auto: Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.GoogleCodePrettify"]);});</script>
<script src="http://wiki.localhost/extensions/_MTAThemeExtensions/main.js?303"></script><script src="http://wiki.localhost/extensions/_MTAThemeExtensions/topmenu.js?303"></script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":50});});</script></body></html>

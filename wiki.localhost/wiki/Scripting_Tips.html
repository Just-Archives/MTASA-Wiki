<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Scripting Tips - Multi Theft Auto: Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Scripting_Tips","wgTitle":"Scripting Tips","wgCurRevisionId":62539,"wgRevisionId":62539,"wgArticleId":7852,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Scripting_Tips","wgRelevantArticleId":7852,"wgRequestId":"dde6b7f42a3a03f6ca0f5339","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":false,"dialogs":false,"preview":false,"publish":false}});mw.loader.implement("user.options",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="http://wiki.localhost/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook"/>
<!--[if IE 6]><link rel="stylesheet" href="/skins/MonoBook/IE60Fixes.css?303" media="screen"/><![endif]--><!--[if IE 7]><link rel="stylesheet" href="/skins/MonoBook/IE70Fixes.css?303" media="screen"/><![endif]-->
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="http://wiki.localhost/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook"/>
<script async="" src="http://wiki.localhost/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook"></script>
<meta name="generator" content="MediaWiki 1.27.5"/>
<link rel="shortcut icon" href="http://wiki.localhost/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.localhost/opensearch_desc.php" title="Multi Theft Auto: Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.multitheftauto.com/api.php?action=rsd"/>
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html"/>
<link rel="alternate" type="application/atom+xml" title="Multi Theft Auto: Wiki Atom feed" href="http://wiki.localhost/index.php?title=Special:RecentChanges&amp;feed=atom"/>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Scripting_Tips rootpage-Scripting_Tips skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Scripting Tips</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Multi Theft Auto: Wiki</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>This page contains a variety of things that knowing, make life easier for MTA scripters.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#General_Lua"><span class="tocnumber">1</span> <span class="toctext">General Lua</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#MTA_Scripting"><span class="tocnumber">2</span> <span class="toctext">MTA Scripting</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#MTA_Scripting_-_Element_IDs_Being_Reused"><span class="tocnumber">3</span> <span class="toctext">MTA Scripting - Element IDs Being Reused</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Server_Performance"><span class="tocnumber">4</span> <span class="toctext">Server Performance</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Client_Performance"><span class="tocnumber">5</span> <span class="toctext">Client Performance</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Speed_comparison_between_local_and_global_variables"><span class="tocnumber">6</span> <span class="toctext">Speed comparison between local and global variables</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Slower"><span class="tocnumber">6.1</span> <span class="toctext">Slower</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Faster"><span class="tocnumber">6.2</span> <span class="toctext">Faster</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#Speed_comparison_between_structural_and_OOP_scripting"><span class="tocnumber">7</span> <span class="toctext">Speed comparison between structural and OOP scripting</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Slower_2"><span class="tocnumber">7.1</span> <span class="toctext">Slower</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Faster_2"><span class="tocnumber">7.2</span> <span class="toctext">Faster</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="General_Lua">General Lua</span></h2>
<ul><li> The <i>infinite loop / too long execution error</i> which aborts execution can be disabled with <i>debug.sethook(nil)</i></li>
<li> Be careful when looping a table where you intend to delete multiple rows, if 2 of them are in a row the 2nd one will get skipped! You must loop the table backwards (reverse ipairs). For example: <i>for i = #table, 1, -1 do</i></li>
<li> Rather than having if checks inside if checks inside if checks, consider using <i>return</i> for example <i>if (not ready) then return false end</i></li>
<li> Keep event, variable &amp; function names short but understandable - longer names will make the file larger in size. In client files, this will increase download time.</li>
<li> Remember that 'false' boolean has a value - If you want to delete a variable or element/account data, use 'nil' instead - this will reduce memory and disk usage (minuscule optimization, only notable on larger servers)</li></ul>
<h2><span class="mw-headline" id="MTA_Scripting">MTA Scripting</span></h2>
<ul><li> Remember that 99% of the time it's a bug in your script, not an MTA bug! Don't report something to GitHub Issues until you're absolutely certain the bug can be reproduced with a small piece of script.</li>
<li> As MTA already has so many functions and events virtually everything you want to do is already possible, as long as you're willing to do the work! You'll find better solutions to problems as there are many ways to achieve the same thing as long as you know all the functions and events.</li>
<li> If a script is getting too complicated, try putting back-end stuff in another file so the main script calls the functions in the 2nd one. For example rather than having meaningless things like <i>vehicleTable[vehicle][7]</i> in the main file, put that in a function in the 2nd file and have the main file call a meaningfully named function so rather than seeing a useless <i>7</i> you'd see something like <i>getFuel</i> and although this might take longer to set-up you'll save time in the long run as you'll spend less time being confused when you come back to it in a weeks time to debug a problem.</li>
<li> Your client side scripts can cause desync if you're not careful, try to keep the psychical world equal with every player. For example if your script creates a client side object make sure your script will create it for everyone nearby, else people will be wondering why a player appears to be constantly floating and falling.</li>
<li> Instead of using <i>onClientResourceStart</i> or <i>onResourceStart</i> events attached to <i>resourceRoot</i> like this:</li></ul>
<pre class="prettyprint lang-lua">function warnPeopleThatThisResourceStarted()
    outputChatBox("The resource " .. getResourceName(resource) .. " has just started!", 0, 255, 0)
end
addEventHandler("onClientResourceStart", resourceRoot, warnPeopleThatThisResourceStarted)</pre>
<p>You can also use this outside of any function:
</p>
<pre class="prettyprint lang-lua">outputChatBox("The resource " .. getResourceName(resource) .. " has just started!", 0, 255, 0)</pre>
<p>And the result will be the same, because Lua executes every instruction in every script file of a resource when it starts.
</p>
<ul><li> string.dump produces unsigned compiled Lua code which is not allowed for security reasons. The only way to transport code now is by using the source code. e.g.:</li></ul>
<pre class="prettyprint lang-lua">exampleFunction = [===[
    return param
]===]

local loadedFunction = loadstring(exampleFunction)</pre>
<h2><span class="mw-headline" id="MTA_Scripting_-_Element_IDs_Being_Reused">MTA Scripting - Element IDs Being Reused</span></h2>
<ul><li> If your script is covered in <a href="IsTimer.html" title="IsTimer">isTimer</a> and <a href="IsElement.html" title="IsElement">isElement</a> checks to hide debug warnings from deleted elements not being dereferenced (making the variable nil) you will regret it when that element ID or timer pointer has to be re-used by MTA in a weeks time and your script starts acting strangely and you won't have a clue why. Dereference destroyed elements and disconnected players!</li>
<li> Why would MTA reuse it in a weeks time? Everything has a userdata value whether it's a function or an element, there is a limited amount of these available meaning that eventually the server will be forced to use the same userdata value twice, as long as whatever that userdata value was for is no longer valid. This could happen within hours, weeks or even never depending on how many elements are being created and destroyed by your scripts.</li>
<li> For example if you have a race server that has 100 objects in every map and the map was changing every 5 minutes your server would go through at least 1200 an hour, 28,800 a day, 201,600 a week in userdata values, it can't keep going up and up though eventually it will have to reuse the same userdata values and as long as you're dereferencing in your scripts, it won't be a problem.</li></ul>
<p>The is an example of a script which fails to dereference, because when the player quits their userdata value remains in the table, but what if in a weeks time another player joins and they get assigned the same userdata value?
</p>
<pre class="prettyprint lang-lua">

local admins = {}
local secretPasswordOnlyAdminsShouldKnow = "12345678"

function adminLogin()
    if (hasObjectPermissionTo(source, "command.ban", false)) then
        admins[source] = true
    end
end
addEventHandler("onPlayerLogin", root, adminLogin)

function cmdGetSecretPassword(plr)
    if (not admins[plr]) then
        return false
    end
    outputChatBox("The secret password is "..secretPasswordOnlyAdminsShouldKnow, plr)
end
addCommandHandler("getsecretpass", cmdGetSecretPassword)
</pre>
<p>Some random player who joins in a weeks time gets the same userdata value as an admin, that player can now use "getsecretpass". Solution? De-reference on destruction!
</p>
<pre class="prettyprint lang-lua">

function onQuit()
    admins[source] = nil
end
addEventHandler("onPlayerQuit", root, onQuit)
</pre>
<h2><span class="mw-headline" id="Server_Performance">Server Performance</span></h2>
<ul><li> Server lagging? Check <a href="Debugging.html#Debugging_Performance_Issues" title="Debugging">this page of debugging performance issues</a></li>
<li> Using resourceRoot in event handlers for events from clients is much more efficient than using root.</li>
<li> Try to be efficient, but if what you're doing is too time consuming or complex, is it really efficient?</li>
<li> It's much more efficient to <a href="SetElementHealth.html" title="SetElementHealth">SetElementHealth</a> and <a href="SetElementRotation.html" title="SetElementRotation">setElementRotation</a> on a player client side, consider a client event all your server scripts can call to set a players health.</li>
<li> Unless you have hundreds of players, don't worry about making little optimizations, check <i>performancebrowser</i> or <i>ipb</i> (ingame performancebrowser) and make sure no resource is using significantly more than the others.</li></ul>
<h2><span class="mw-headline" id="Client_Performance">Client Performance</span></h2>
<ul><li> The biggest cause of client script CPU usage is anything done in onClient/Pre/Hud/Render because it is called so often. For example if you have a script which calls dxDrawLine3D 20 times, 60 times a second, if those lines are only in 1 part of the map, consider adding a <a href="GetDistanceBetweenPoints3D.html" title="GetDistanceBetweenPoints3D">getDistanceBetweenPoints3D</a> check between the local player and the general area that those lines are in and if they're no where near the player, don't draw the lines.</li>
<li> Another thing that gets called a lot and could therefore be quite consuming if not careful are events like <a href="OnClientPlayerWeaponFire.html" title="OnClientPlayerWeaponFire">onClientPlayerWeaponFire</a> and <a href="OnClientPlayerDamage.html" title="OnClientPlayerDamage">onClientPlayerDamage</a> so any scripts that use these should only be bound to the necessary elements (such as localPlayer instead of root) and run the simplest if statements for example if you wanted to handle a certain weapon being fired in a certain dimension it's better to check weapon first as that's a simple weaponID == x rather than getElementDimension(source) == y.</li>
<li> Start checking variables since least aggravating. Example, first do simple checks: interior, dimension, distance, then check elementDatas, exports etc.</li></ul>
<h2><span class="mw-headline" id="Speed_comparison_between_local_and_global_variables">Speed comparison between local and global variables</span></h2>
<h3><span class="mw-headline" id="Slower">Slower</span></h3>
<pre class="prettyprint lang-lua">

start = getTickCount()
a = 1
for i=1,10000000 do
   a = 1
end
stop = getTickCount()
print("global", stop - start ) -- more then 500ms
</pre>
<h3><span class="mw-headline" id="Faster">Faster</span></h3>
<pre class="prettyprint lang-lua">
start = getTickCount()
local b = 1
for i=1,10000000 do
   b = 1
end
stop = getTickCount()
print("local", stop - start ) -- less then 200ms
</pre>
<h2><span class="mw-headline" id="Speed_comparison_between_structural_and_OOP_scripting">Speed comparison between structural and OOP scripting</span></h2>
<h3><span class="mw-headline" id="Slower_2">Slower</span></h3>
<pre class="prettyprint lang-lua">
start = getTickCount()
a = 1
for i=1,1000000 do
   a = localPlayer.position
end
stop = getTickCount()
print("variable", stop - start ) -- more then 1500ms
</pre>
<h3><span class="mw-headline" id="Faster_2">Faster</span></h3>
<pre class="prettyprint lang-lua">
start = getTickCount()
b = nil
for i=1,1000000 do
   b = getElementPosition(localPlayer)
end
stop = getTickCount()
print("structural", stop - start ) -- less then 200ms
</pre>

<!-- 
NewPP limit report
Cached time: 20190629062659
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.004 seconds
Real time usage: 0.005 seconds
Preprocessor visited node count: 118/1000000
Preprocessor generated node count: 228/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key mta_wiki-wiki_dev_:pcache:idhash:7852-0!*!0!!en!*!* and timestamp 20190629062659 and revision id 62539
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.multitheftauto.com/index.php?title=Scripting_Tips&amp;oldid=62539">https://wiki.multitheftauto.com/index.php?title=Scripting_Tips&amp;oldid=62539</a>"</div>
					<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="Scripting_Tips.html" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk"><a href="Talk_Scripting_Tips.html" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="http://wiki.localhost/index.php?title=Scripting_Tips&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="http://wiki.localhost/index.php?title=Scripting_Tips&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="http://wiki.localhost/index.php?title=Special:CreateAccount&amp;returnto=Scripting+Tips" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="http://wiki.localhost/index.php?title=Special:UserLogin&amp;returnto=Scripting+Tips" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="Main_Page.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Home"><a href="Main_Page.html">Home</a></li>
											<li id="n-How-you-can-help"><a href="How_you_can_help.html">How you can help</a></li>
											<li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="https://wiki.multitheftauto.com/wiki/OnDgsDestroy" title="Load a random page [x]" accesskey="x">Random page</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-reference" role="navigation">
		<h3>reference</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Client-Functions"><a href="Client_Scripting_Functions.html">Client Functions</a></li>
											<li id="n-Client-Events"><a href="Client_Scripting_Events.html">Client Events</a></li>
											<li id="n-Server-Functions"><a href="Server_Scripting_Functions.html">Server Functions</a></li>
											<li id="n-Server-Events"><a href="Server_Scripting_Events.html">Server Events</a></li>
											<li id="n-Shared-Functions"><a href="Shared_Scripting_Functions.html">Shared Functions</a></li>
											<li id="n-Useful-Functions"><a href="Useful_Functions.html">Useful Functions</a></li>
											<li id="n-MTA-Classes"><a href="MTA_Classes.html">MTA Classes</a></li>
											<li id="n-MTA-Elements"><a href="Element.html">MTA Elements</a></li>
											<li id="n-Element-Tree"><a href="Element_tree.html">Element Tree</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="http://wiki.localhost/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Multi Theft Auto: Wiki [f]" accesskey="f" id="searchInput"/>
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton"/>&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton"/>
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/Scripting_Tips.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/Scripting_Tips.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="http://wiki.localhost/index.php?title=Scripting_Tips&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="http://wiki.localhost/index.php?title=Scripting_Tips&amp;oldid=62539" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="http://wiki.localhost/index.php?title=Scripting_Tips&amp;action=info" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="http://www.gnu.org/copyleft/fdl.html"><img src="../resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.2" width="88" height="31"/></a>
							</div>
					<div id="f-poweredbyico">
									<a href="http://www.mediawiki.org/"><img src="../resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>
							</div>
					<ul id="f-list">
									<li id="lastmod"> This page was last modified on 1 May 2019, at 15:45.</li>
									<li id="copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.2</a> unless otherwise noted.</li>
									<li id="privacy"><a href="Multi_Theft_Auto__Wiki_Privacy_policy.html" title="Multi Theft Auto: Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="Multi_Theft_Auto__Wiki_About.html" title="Multi Theft Auto: Wiki:About">About Multi Theft Auto: Wiki</a></li>
									<li id="disclaimer"><a href="Multi_Theft_Auto__Wiki_General_disclaimer.html" title="Multi Theft Auto: Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.GoogleCodePrettify"]);});</script>
<script src="../extensions/_MTAThemeExtensions/main11b9.js?303"></script><script src="../extensions/_MTAThemeExtensions/topmenu11b9.js?303"></script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":44});});</script></body></html>
